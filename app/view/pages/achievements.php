<?php
session_start();
require_once __DIR__ . '/../../api/db_connect.php';
if (empty($_SESSION['logueando'])) { header('Location: /public/login.php'); exit; }
?>
<!doctype html><html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Logros ‚Äî ENYOOI</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"><style>:root{--accent:#ff4fa3;--accent-2:#7c5cff}html,body{height:100%;margin:0;padding:0;font-family:'Poppins',sans-serif;background:radial-gradient(1200px 600px at 10% 10%,rgba(124,92,255,0.12),transparent 8%),linear-gradient(180deg,#020617 0%,#081127 100%);color:#e6eef8}.card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);backdrop-filter:blur(6px);border-radius:12px;padding:18px}.badge-unlocked{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#071022}.badge-locked{background:rgba(255,255,255,0.04);color:#cbd5e1}</style></head><body><div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div><main class="min-h-screen p-6"><div class="max-w-4xl mx-auto"><header class="mb-6 flex items-center justify-between"><h1 class="text-3xl font-bold">Tus logros</h1><a href="/app/view/pages/tienda.php" class="px-4 py-2 badge-unlocked rounded">Ir a la tienda</a></header><section class="card mb-6"><h2 class="text-xl font-semibold mb-3">Logros desbloqueados</h2><div id="unlocked" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div></section><section class="card"><h2 class="text-xl font-semibold mb-3">Logros por desbloquear</h2><div id="locked" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div></section></div></main><script>async function load(){ const res = await fetch('/api/get_user_achievements.php', {credentials:'include'}); const j = await res.json(); if (!j.ok) { document.getElementById('unlocked').innerText='No se pudo cargar'; return; } const unlocked = j.unlocked || []; const locked = j.locked || []; const uwrap = document.getElementById('unlocked'); const lwrap = document.getElementById('locked'); uwrap.innerHTML=''; lwrap.innerHTML=''; unlocked.forEach(a => { const div = document.createElement('div'); div.className = 'p-3 rounded-xl bg-white/3 flex items-center gap-3'; div.innerHTML = `<div class="w-16 h-16 rounded-full badge-unlocked flex items-center justify-center text-sm font-bold">${a.zafiros_reward ? 'üíé'+a.zafiros_reward : 'üèÜ'}</div><div><div class="font-semibold">${a.title}</div><div class="text-sm text-blue-200">${a.description}</div><div class="text-xs text-blue-100 mt-1">Desbloqueado: ${a.granted_at}</div></div>`; uwrap.appendChild(div); }); locked.forEach(a => { const div = document.createElement('div'); div.className = 'p-3 rounded-xl bg-white/3 flex items-center gap-3'; div.innerHTML = `<div class="w-16 h-16 rounded-full badge-locked flex items-center justify-center text-sm font-bold">?</div><div><div class="font-semibold">${a.title}</div><div class="text-sm text-blue-200">${a.description}</div><div class="text-xs text-blue-100 mt-1">Recompensa: ${a.zafiros_reward ? 'üíé'+a.zafiros_reward : '‚Äî'}</div><div class="mt-2"><button class="px-3 py-1 badge-unlocked rounded text-sm" onclick="claim('${a.code}')">Intentar desbloquear</button></div></div>`; lwrap.appendChild(div); }); } async function claim(code){ const fd = new FormData(); fd.append('code', code); const res = await fetch('/api/grant_achievement.php', {method:'POST', body: fd, credentials:'include'}); const j = await res.json(); if (j.ok && j.granted) alert('Logro desbloqueado y recompensa otorgada!'); else if (j.ok) alert('No se pudo desbloquear (posiblemente ya desbloqueado).'); else alert('Error: '+(j.error||'')); load(); } load();</script></body></html>